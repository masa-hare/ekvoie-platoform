# Student Voice Platform - TODO

## LLM/分析コード削除と通知機能説明の修正

### Phase 1: LLM/分析コードを検索して削除
- [x] server/配下でLLM/forge/opinionAnalysis/clustering/embedding関連のコードを検索
- [x] 未使用のLLM呼び出しコードを削除
- [x] 未使用の意見グルーピング/分析コードを削除
- [x] 未使用の型定義・import・APIルートを削除

### Phase 2: 不要な依存パッケージを削除
- [x] package.jsonから不要な依存パッケージを削除（不要なパッケージなし）
- [x] pnpm installを実行して依存関係を更新

### Phase 3: 未使用環境変数を整理
- [x] server/_core/env.ts等で未使用環境変数の参照を削除
- [x] .env.example等のドキュメントを整理

### Phase 4: Aboutページの文言を修正
- [x] AI/LLMによる投稿内容の分析・分類・評価は行っていないことを明記
- [x] 通知機能（新規投稿等の通知）について正確に説明
- [x] 通知されるイベント種類、通知先、通知に含まれる情報の範囲を明記

### Phase 5: テスト実行とチェックポイント作成
- [x] npm run buildを実行
- [x] npm testを実行
- [x] 主要機能（投稿/投票/一覧/詳細/管理者）の動作確認
- [x] 最終チェックポイント作成

## PII検出ロジックの改善

### Phase 1: 現在の実装を調査
- [x] server/piiDetection.tsの現在の実装を確認
- [x] lastIndex問題（gフラグ付き正規表現の.test()使用）を特定

### Phase 2: バグ修正と検出範囲拡張
- [x] PII検出のlastIndex問題を修正（gフラグ削除）
- [x] 電話番号検出を追加（携帯・固定）
- [x] メールアドレス検出を追加
- [x] SNS/連絡ID検出を追加（LINE ID, Instagram @, X @, Discord等）
- [x] 住所検出を追加（都道府県+市区町村、番地、マンション号室等）
- [x] 学籍番号/学生番号検出を追加（8〜12桁程度の連続数字）

### Phase 3: ユニットテスト作成
- [x] PII検出のユニットテストを作成（22ケース）
- [x] 電話/メール/住所/IDのブロック例をテスト
- [x] ブロックされない正常例（一般文）をテスト
- [x] lastIndex問題の修正を検証（一貫性テスト）

### Phase 4: 検証とチェックポイント
- [x] npm run buildを実行（成功）
- [x] npm testを実行（35テスト全てパス）
- [x] TypeScript型チェック（エラーなし）
- [x] UI/UXが変わっていないことを確認
- [x] 最終チェックポイント作成

## セキュリティ監査とリポジトリ・サニタイズ

### Phase 1: リポジトリ全体スキャン
- [x] 機密情報を含むファイルを特定（DB接続情報、APIキー、トークン等）
- [x] デバッグ資産を特定（.manus/, __manus__/, db-query*.json等）
- [x] 個人情報を含むログを特定

### Phase 2: 機密ファイル削除
- [x] .manus-logs/ ディレクトリを削除（1.8MB）
- [x] 参照している import/URL/リンクを削除（該当なし）

### Phase 3: 再発防止
- [x] .gitignore に機密ファイルパターンを追加
- [x] ビルド成果物に機密情報が含まれないことを確認

### Phase 4: 検証
- [x] 危険物が残っていないことを確認
- [x] npm run build 成功
- [x] npm test 成功（35テスト全てパス）
- [x] 主要機能（投稿/投票/閲覧/管理者）が動作することを確認

### Phase 5: 報告
- [x] SECURITY_SANITIZATION_REPORT.md を作成
- [x] 変更点を git diff 形式で確認
- [x] 削除したファイル一覧を記録
- [x] チェックポイント作成

## 分析ページ表示問題とAboutページ修正

### Phase 1: 分析ページが表示されない原因を調査
- [x] App.tsxのルーティング設定を確認
- [x] 分析ページのコンポーネントが存在するか確認
- [x] 削除されたページへの参照がないか確認

### Phase 2: 分析ページの問題を修正
- [x] 分析ページ（Analytics.tsx）を新規作成
- [x] App.tsxに分析ページのルートを追加（/analytics）
- [x] 投票結果の統計を表示（総意見数、総投票数、平均投票数、カテゴリー数）
- [x] 投票分布を可視化（賛成/反対/パスの比率）
- [x] カテゴリー別集計を表示

### Phase 3: Aboutページの文章を修正
- [x] 「投稿は原則、管理者承認後に公開されます」を追加
- [x] 通知機能の説明を修正（投稿内容ではなく運用情報のみ送信）
- [x] 外部AIへの送信について明記（送らない設計）
- [x] 個人情報検出処理がサーバー内で完結することを明記
- [x] 運営通知に投稿本文や個人情報が含まれないことを明記

### Phase 4: ビルドとテスト
- [x] npm run build を実行（成功）
- [x] npm test を実行（35テスト全てパス）
- [x] 分析ページが表示されることを確認

### Phase 5: チェックポイント作成
- [x] todo.mdを更新
- [x] チェックポイントを作成
